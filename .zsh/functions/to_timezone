# Function: to_timezone
# Description: Converts timezone shortcodes to full timezone commands and copies results to clipboard
#
# Usage: to_timezone [shortcode] [time]
#   where [shortcode] is one of the supported timezone codes (defaults to 'team')
#   where [time] is an optional time (e.g., 2pm, 1400, 14:00, etc.)
#
# Examples:
#   to_timezone           # Shows current time in team timezones
#   to_timezone au        # Shows current time in AU timezones
#   to_timezone 2pm       # Shows 2:00 PM in team timezones
#   to_timezone au 1:30pm # Shows 1:30 PM in AU timezones
#   to_timezone --help    # Shows available timezones and usage
function to_timezone() {
  # Define timezone constants
  local TZ_TEAM="Australia/Melbourne,Australia/Brisbane,Asia/Manila,Africa/Johannesburg"
  local TZ_AU="Australia/Melbourne,Australia/Brisbane"
  local TZ_APPS="Australia/Melbourne,Europe/London,America/Chicago"

  local timezone="${1:-team}"
  local time="$2"
  local tz_string=""
  local result=""

  # Handle --help flag
  if [[ "$timezone" == "--help" || "$timezone" == "-h" ]]; then
    cat << 'EOF'
to_timezone - Convert and display times across team timezones

USAGE:
  to_timezone [shortcode] [time]

SHORTCODES:
  team  - Australia/Melbourne, Australia/Brisbane, Asia/Manila, Africa/Johannesburg (DEFAULT)
  au    - Australia/Melbourne, Australia/Brisbane
  apps  - Australia/Melbourne, Europe/London, America/Chicago

TIME:
  Optional time in any of these formats:
    - 24-hour format: 1400, 14:00 (for 2:00 PM)
    - 12-hour format: 2pm, 2:30pm, 2am, etc.

EXAMPLES:
  to_timezone           # Shows current time in team timezones
  to_timezone au        # Shows current time in AU timezones
  to_timezone 2pm       # Shows 2:00 PM in team timezones
  to_timezone au 1:30pm # Shows 1:30 PM in AU timezones

EOF
    return 0
  fi

  # Define timezone mappings
  case "$timezone" in
    team)
      tz_string="$TZ_TEAM"
      ;;
    au)
      tz_string="$TZ_AU"
      ;;
    apps)
      tz_string="$TZ_APPS"
      ;;
    *)
      # Check if first argument looks like a time format (not a timezone shortcode)
      if [[ "$timezone" =~ ^[0-9]{1,2}(am|pm|:[0-9]{2}(am|pm)?)?$ ]] || [[ "$timezone" =~ ^[0-9]{4}$ ]] || [[ "$timezone" =~ ^[0-9]{1,2}:[0-9]{2}$ ]]; then
        # Treat as time, use default team timezone
        time="$timezone"
        tz_string="$TZ_TEAM"
      else
        echo "Unknown timezone shortcode: $timezone"
        echo "Available shortcodes: apps, au, team"
        echo "Run 'to_timezone --help' for more information"
        return 1
      fi
      ;;
  esac

  # Execute the command with or without time parameter
  if [ -z "$time" ]; then
    result=$(tz at "$tz_string")
  else
    result=$(tz at "$tz_string" "$time")
  fi

  echo "$result" | pbcopy
  echo "ðŸ“‹ $result"
}
